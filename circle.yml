machine:
  ruby:
      version: 2.3.1
  hosts:
    circlehost: 127.0.0.1
    dev.mycompany.com: 127.0.0.1

dependencies:
  pre:
    - pip install --upgrade pip
    - pip install diff_cover
    - pip install coverage
    - pip install nose

database:
  override:
    - cp config/database.yml.tmp config/database.yml
    - bundle exec rake db:create db:migrate

test:
  override:
    - bundle exec thin start:
          background: true
    - echo 'to sleep'
    - sleep 30
    - echo 'wake up'
    - curl http://dev.mycompany.com:3000
    - bundle exec rake test

  post:
    - nosetests --with-coverage
    - coverage xml